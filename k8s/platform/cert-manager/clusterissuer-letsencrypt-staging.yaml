# Let's Encrypt Staging ClusterIssuer
#
# Use this issuer for testing to avoid hitting Let's Encrypt rate limits.
# Staging certificates are not trusted by browsers, but they verify that
# your DNS challenge is working correctly.
#
# Rate limits for staging:
# - 30,000 certificates per week
# - Much more lenient than production
#
# After verifying staging works, switch to production issuer.

---
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging
  labels:
    app: cert-manager
    environment: staging
spec:
  acme:
    # Let's Encrypt staging server
    server: https://acme-staging-v02.api.letsencrypt.org/directory

    # Email for Let's Encrypt account (important for renewal notifications)
    # TODO: Replace with your actual email
    email: YOUR_EMAIL@example.com

    # Secret to store ACME account private key
    privateKeySecretRef:
      name: letsencrypt-staging

    # DNS-01 challenge solver using Cloudflare
    solvers:
    - dns01:
        cloudflare:
          # Cloudflare API token secret reference
          apiTokenSecretRef:
            name: cloudflare-api-token
            key: api-token

      # This solver applies to yourdomain.com and its subdomains
      selector:
        dnsZones:
        - yourdomain.com
